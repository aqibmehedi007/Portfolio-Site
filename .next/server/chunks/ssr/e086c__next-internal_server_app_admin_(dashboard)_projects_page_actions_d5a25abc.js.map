{"version":3,"sources":["../../../../../../GitHub/Portfolio-Site/src/app/admin/%28dashboard%29/projects/actions.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { prisma } from \"@/core/prisma\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\nfunction makeSlug(title: string): string {\r\n    return title.toLowerCase().replace(/[^a-z0-9\\s]/g, \"\").trim().replace(/\\s+/g, \"-\");\r\n}\r\n\r\nexport async function deleteProject(id: string) {\r\n    try {\r\n        await prisma.project.delete({ where: { id } });\r\n        revalidatePath('/');\r\n        revalidatePath('/best-ai-engineer-bangladesh');\r\n        revalidatePath('/admin/projects');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Delete Error\", error);\r\n        return { success: false, error: \"Failed to delete project\" };\r\n    }\r\n}\r\n\r\nexport async function upsertProject(data: any, id?: string) {\r\n    try {\r\n        const { content, contentType, ...rest } = data;\r\n\r\n        if (id) {\r\n            // On update: regenerate slug if title changed, preserve existing slug otherwise\r\n            const existing = await prisma.project.findUnique({ where: { id }, select: { slug: true, title: true } });\r\n            const newSlug = existing && existing.title !== rest.title\r\n                ? makeSlug(rest.title)\r\n                : existing?.slug;\r\n\r\n            await prisma.project.update({\r\n                where: { id },\r\n                data: {\r\n                    ...rest,\r\n                    slug: newSlug || makeSlug(rest.title),\r\n                    content: content || null,\r\n                    contentType: contentType || \"markdown\",\r\n                    updatedAt: new Date(),\r\n                }\r\n            });\r\n        } else {\r\n            const slug = makeSlug(rest.title);\r\n            await prisma.project.create({\r\n                data: {\r\n                    ...rest,\r\n                    slug,\r\n                    content: content || null,\r\n                    contentType: contentType || \"markdown\",\r\n                    orderIdx: await prisma.project.count(),\r\n                }\r\n            });\r\n        }\r\n\r\n        revalidatePath('/');\r\n        revalidatePath('/best-ai-engineer-bangladesh');\r\n        revalidatePath('/admin/projects');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Upsert Error\", error);\r\n        return { success: false, error: \"Failed to save project\" };\r\n    }\r\n}\r\n"],"names":[],"mappings":"0DAEA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,OAEA,SAAS,EAAS,CAAa,EAC3B,OAAO,EAAM,WAAW,GAAG,OAAO,CAAC,eAAgB,IAAI,IAAI,GAAG,OAAO,CAAC,OAAQ,IAClF,CAEO,eAAe,EAAc,CAAU,EAC1C,GAAI,CAKA,OAJA,MAAM,EAAA,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAE,MAAO,CAAE,IAAG,CAAE,GAC5C,CAAA,EAAA,EAAA,cAAc,AAAd,EAAe,KACf,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,gCACf,CAAA,EAAA,EAAA,cAAc,AAAd,EAAe,mBACR,CAAE,SAAS,CAAK,CAC3B,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,eAAgB,GACvB,CAAE,SAAS,EAAO,MAAO,0BAA2B,CAC/D,CACJ,CAEO,eAAe,EAAc,CAAS,CAAE,CAAW,EACtD,GAAI,CACA,GAAM,SAAE,CAAO,aAAE,CAAW,CAAE,GAAG,EAAM,CAAG,EAE1C,GAAI,EAAI,CAEJ,IAAM,EAAW,MAAM,EAAA,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAAE,MAAO,IAAE,CAAG,EAAG,OAAQ,CAAE,MAAM,EAAM,OAAO,CAAK,CAAE,GAChG,EAAU,GAAY,EAAS,KAAK,GAAK,EAAK,KAAK,CACnD,EAAS,EAAK,KAAK,EACnB,GAAU,IAEhB,OAAM,EAAA,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CACxB,MAAO,IAAE,CAAG,EACZ,KAAM,CACF,GAAG,CAAI,CACP,KAAM,GAAW,EAAS,EAAK,KAAK,EACpC,QAAS,GAAW,KACpB,YAAa,GAAe,WAC5B,UAAW,IAAI,IACnB,CACJ,EACJ,KAAO,CACH,IAAM,EAAO,EAAS,EAAK,KAAK,CAChC,OAAM,EAAA,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CACxB,KAAM,CACF,GAAG,CAAI,MACP,EACA,QAAS,GAAW,KACpB,YAAa,GAAe,WAC5B,SAAU,MAAM,EAAA,MAAM,CAAC,OAAO,CAAC,KAAK,EACxC,CACJ,EACJ,CAKA,MAHA,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,KACf,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,gCACf,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,mBACR,CAAE,SAAS,CAAK,CAC3B,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,eAAgB,GACvB,CAAE,SAAS,EAAO,MAAO,wBAAyB,CAC7D,CACJ,2CAvDsB,EAaA,IAbA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAaA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA"}